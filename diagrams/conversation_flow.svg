<svg viewBox="0 0 1000 1200" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1000" height="1200" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" fill="#1e293b" font-size="20" font-weight="bold">Flujo de Conversación Voice AI Agent</text>
  
  <!-- Start -->
  <ellipse cx="500" cy="80" rx="60" ry="25" fill="#10b981" stroke="#047857" stroke-width="2"/>
  <text x="500" y="87" text-anchor="middle" fill="white" font-size="12" font-weight="bold">INICIO</text>
  
  <!-- Incoming Call -->
  <rect x="425" y="130" width="150" height="40" rx="8" fill="#3b82f6" stroke="#1e40af" stroke-width="2"/>
  <text x="500" y="155" text-anchor="middle" fill="white" font-size="12">Llamada Entrante</text>
  
  <!-- Twilio Processing -->
  <rect x="425" y="200" width="150" height="40" rx="8" fill="#ef4444" stroke="#dc2626" stroke-width="2"/>
  <text x="500" y="225" text-anchor="middle" fill="white" font-size="12">Twilio Recibe</text>
  
  <!-- WebSocket Notification -->
  <rect x="425" y="270" width="150" height="40" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2"/>
  <text x="500" y="295" text-anchor="middle" fill="white" font-size="12">WS Notifica</text>
  
  <!-- Agent Selection -->
  <rect x="425" y="340" width="150" height="40" rx="8" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
  <text x="500" y="365" text-anchor="middle" fill="white" font-size="12">Seleccionar Agente</text>
  
  <!-- Agent Initialization -->
  <rect x="425" y="410" width="150" height="40" rx="8" fill="#06b6d4" stroke="#0891b2" stroke-width="2"/>
  <text x="500" y="435" text-anchor="middle" fill="white" font-size="12">Inicializar Agente</text>
  
  <!-- Conversation Loop -->
  <rect x="300" y="480" width="400" height="300" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
  <text x="500" y="505" text-anchor="middle" fill="#92400e" font-size="14" font-weight="bold">BUCLE DE CONVERSACIÓN</text>
  
  <!-- Voice Input -->
  <rect x="350" y="530" width="120" height="35" rx="5" fill="#ef4444" stroke="#dc2626" stroke-width="1"/>
  <text x="410" y="552" text-anchor="middle" fill="white" font-size="10">Audio Input</text>
  
  <!-- Speech to Text -->
  <rect x="530" y="530" width="120" height="35" rx="5" fill="#8b5cf6" stroke="#7c3aed" stroke-width="1"/>
  <text x="590" y="552" text-anchor="middle" fill="white" font-size="10">STT (Deepgram)</text>
  
  <!-- AI Processing -->
  <rect x="530" y="590" width="120" height="35" rx="5" fill="#10b981" stroke="#047857" stroke-width="1"/>
  <text x="590" y="612" text-anchor="middle" fill="white" font-size="10">AI Processing</text>
  
  <!-- Text to Speech -->
  <rect x="350" y="590" width="120" height="35" rx="5" fill="#8b5cf6" stroke="#7c3aed" stroke-width="1"/>
  <text x="410" y="612" text-anchor="middle" fill="white" font-size="10">TTS (Deepgram)</text>
  
  <!-- Voice Output -->
  <rect x="350" y="650" width="120" height="35" rx="5" fill="#ef4444" stroke="#dc2626" stroke-width="1"/>
  <text x="410" y="672" text-anchor="middle" fill="white" font-size="10">Audio Output</text>
  
  <!-- Context Update -->
  <rect x="530" y="650" width="120" height="35" rx="5" fill="#6b7280" stroke="#374151" stroke-width="1"/>
  <text x="590" y="672" text-anchor="middle" fill="white" font-size="10">Update Context</text>
  
  <!-- Decision Diamond -->
  <polygon points="500,720 540,740 500,760 460,740" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
  <text x="500" y="745" text-anchor="middle" fill="white" font-size="10">Continuar?</text>
  
  <!-- End Call -->
  <rect x="425" y="820" width="150" height="40" rx="8" fill="#dc2626" stroke="#991b1b" stroke-width="2"/>
  <text x="500" y="845" text-anchor="middle" fill="white" font-size="12">Finalizar Llamada</text>
  
  <!-- Analytics -->
  <rect x="200" y="890" width="150" height="40" rx="8" fill="#6b7280" stroke="#374151" stroke-width="2"/>
  <text x="275" y="915" text-anchor="middle" fill="white" font-size="12">Guardar Analytics</text>
  
  <!-- Billing -->
  <rect x="650" y="890" width="150" height="40" rx="8" fill="#6b7280" stroke="#374151" stroke-width="2"/>
  <text x="725" y="915" text-anchor="middle" fill="white" font-size="12">Registrar Billing</text>
  
  <!-- End -->
  <ellipse cx="500" cy="980" rx="60" ry="25" fill="#dc2626" stroke="#991b1b" stroke-width="2"/>
  <text x="500" y="987" text-anchor="middle" fill="white" font-size="12" font-weight="bold">FIN</text>
  
  <!-- Arrows -->
  <path d="M500 105 L500 130" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M500 170 L500 200" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M500 240 L500 270" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M500 310 L500 340" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M500 380 L500 410" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M500 450 L500 480" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Conversation loop arrows -->
  <path d="M470 530 L530 530" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M590 565 L590 590" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M530 612 L470 612" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M410 625 L410 650" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M470 672 L530 672" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M590 685 L590 720 L540 740" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Loop back -->
  <path d="M460 740 L350 740 L350 547 L350 547" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <text x="320" y="635" text-anchor="middle" fill="#64748b" font-size="9">Sí</text>
  
  <!-- Continue to end -->
  <path d="M500 760 L500 820" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="515" y="790" fill="#64748b" font-size="9">No</text>
  
  <!-- Final arrows -->
  <path d="M425 845 L275 890" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M575 845 L725 890" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M350 910 L460 955" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M650 910 L540 955" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Side annotations -->
  <text x="50" y="225" fill="#64748b" font-size="10">Webhook desde Twilio</text>
  <text x="50" y="295" fill="#64748b" font-size="10">Notificación en tiempo real</text>
  <text x="50" y="365" fill="#64748b" font-size="10">Basado en número/config</text>
  <text x="50" y="435" fill="#64748b" font-size="10">Cargar contexto/prompts</text>
  
  <text x="750" y="552" fill="#64748b" font-size="10">Streaming en tiempo real</text>
  <text x="750" y="612" fill="#64748b" font-size="10">LLM + Memory</text>
  <text x="750" y="672" fill="#64748b" font-size="10">Historial + Estado</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>
  
  <!-- Legend -->
  <rect x="750" y="1050" width="230" height="120" rx="5" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
  <text x="865" y="1070" text-anchor="middle" fill="#1e293b" font-size="12" font-weight="bold">LEYENDA</text>
  <rect x="760" y="1080" width="15" height="15" fill="#3b82f6"/>
  <text x="780" y="1092" fill="#1e293b" font-size="10">Twilio/Comunicación</text>
  <rect x="760" y="1100" width="15" height="15" fill="#8b5cf6"/>
  <text x="780" y="1112" fill="#1e293b" font-size="10">Deepgram/Procesamiento</text>
  <rect x="760" y="1120" width="15" height="15" fill="#10b981"/>
  <text x="780" y="1132" fill="#1e293b" font-size="10">IA/Lógica de Negocio</text>
  <rect x="760" y="1140" width="15" height="15" fill="#6b7280"/>
  <text x="780" y="1152" fill="#1e293b" font-size="10">Base de Datos/Storage</text>
</svg>